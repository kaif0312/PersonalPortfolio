import{bV as v,cB as g,cG as j,r as w,j as s,cH as u,aP as y,ck as k,bW as Y,bQ as N,aT as p,aj as M,y as S,aQ as D}from"./index-exFCQBCk.js";import{S as C,a as A,b as L,c as V,d as z,e as O,f as E}from"./select-Bv-dkHeU.js";import{a as G}from"./message-square-text-6dTKbQKA.js";import{h as W,N as I,k as P,P as R,i as f}from"./pagemenu-DlQF5jN4.js";import{G as $,M as B}from"./wallet-cards-xpilOd6G.js";import{S as T}from"./sprout-jOQR37se.js";import{m as _}from"./lucide-react-f58FO8MB.js";const oe=({excludeRanges:e=[]})=>{const{range:t,setRange:r}=v(),l=e.map(a=>g[a].value),n=j.filter(a=>!l.includes(a.value));return w.useEffect(()=>{if(l.includes(t)&&n.length>0){const a=n.find(i=>i.value===g.last7Days.value),c=a?a.value:n[0].value;r(c)}},[t,l,n,r]),s.jsxs(C,{value:`${t}`,onValueChange:a=>{r(Number(a))},children:[s.jsxs(A,{className:"w-auto",children:[s.jsx(G,{className:"mr-2",size:16,strokeWidth:1.5}),s.jsx(L,{placeholder:"Select a period"})]}),s.jsx(V,{align:"end",children:s.jsxs(z,{children:[s.jsx(O,{children:"Period"}),n.map(a=>s.jsx(E,{value:`${a.value}`,children:a.name},a.value))]})})]})},ue=e=>{const t=j.find(r=>r.value===e);return t?["Last 7 days","Last 30 days","Last 90 days","Last 12 months"].includes(t.name)?`in the ${t.name.toLowerCase()}`:t.name==="All time"?"(all time)":t.name.toLowerCase():""};function H(e,t){return u(t).diff(u(e),"days")}function U(e,t){return u(e).isSame(u(t),"month")}function F(e,t){return u(e).isSame(u(t),"week")}function x(e,t,r,l){switch(l){case"sum":return e;case"avg":return t>0?e/t:0;case"exact":return r}}function Q(e){const t=[...e].sort((a,c)=>a-c),r=t[Math.floor(t.length/2)],l=e.map(a=>Math.abs(a-r)),n=l.sort((a,c)=>a-c)[Math.floor(l.length/2)];return{threshold:r+5*n,average:r}}function q(e,t,r,l){return l||(e===-1&&(t>150?e=400:t>60&&(e=100)),r==="exact"&&(e>356||e===-1&&t>150)?"monthly":e>=91&&e<=356||e===-1&&t>60&&t<=150?"weekly":e>356||e===-1&&t>150?"monthly":"none")}function J(e,t){if(e.length<=1)return e;const r=e.map(a=>Number(a[t])),{threshold:l,average:n}=Q(r);return e.map(a=>{const c=Number(a[t]);return{...a,_isOutlier:c>l||c>n*10}})}function K(e,t,r){const l=[];let n=u(e[0].date).startOf("week"),a=0,c=0,i=0;return e.forEach((o,m)=>{const h=u(o.date);F(h.format("YYYY-MM-DD"),n.format("YYYY-MM-DD"))?(a+=Number(o[t]),c+=1,i=Number(o[t])):(l.push({...e[m-1],date:n.format("YYYY-MM-DD"),[t]:x(a,c,i,r)}),n=h.startOf("week"),a=Number(o[t]),c=1,i=Number(o[t])),m===e.length-1&&l.push({...o,date:n.format("YYYY-MM-DD"),[t]:x(a,c,i,r)})}),l}function X(e,t,r){const l=[];let n=u(e[0].date).startOf("month"),a=0,c=0,i=0,o=null;return e.forEach((m,h)=>{const b=u(m.date),d=Number(m[t]);U(b.format("YYYY-MM-DD"),n.format("YYYY-MM-DD"))?(a+=d,c+=1,i=d,o=m):(r==="exact"&&o?l.push({...o,[t]:i}):l.push({...e[h-1],date:n.format("YYYY-MM-DD"),[t]:x(a,c,i,r)}),n=b.startOf("month"),a=d,c=1,i=d,o=m),h===e.length-1&&(r==="exact"&&o?l.push({...o,[t]:i}):l.push({...m,date:n.format("YYYY-MM-DD"),[t]:x(a,c,i,r)}))}),l}const me=(e,t,r="value",l="avg",n)=>{if(!e.length)return[];const a=e.length>1?H(e[0].date,e[e.length-1].date):0,c=q(t,a,l,n);let i;switch(c){case"weekly":i=K(e,r,l);break;case"monthly":i=X(e,r,l);break;default:i=e}return J(i,r)},he=({children:e})=>{const t=y(),r=k(),{appSettings:l}=Y(),{site:n,statsConfig:a}=v(),{activeVisitors:c,isLoading:i}=W({statsConfig:a,enabled:l?.analytics?.webAnalytics??!1}),o=r.pathname.endsWith("/")?r.pathname:`${r.pathname}/`;return s.jsxs(s.Fragment,{children:[s.jsx("header",{className:"z-40 -mx-8 bg-white/70 backdrop-blur-md dark:bg-black",children:s.jsxs("div",{className:"relative flex w-full items-center justify-between gap-5 px-8 pb-0 pt-8","data-header":"header",children:[s.jsx(N,{className:"-ml-px min-h-[35px] max-w-[920px] indent-0 leading-[1.2em]","data-header":"header-title",children:"Analytics"}),l?.analytics.webAnalytics&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n?.url&&s.jsxs("div",{className:"hidden items-center gap-1.5 sm:!visible sm:!flex",children:[s.jsx(p,{className:"text-muted-foreground",size:16,strokeWidth:1.5}),s.jsx("a",{className:"text-sm font-medium transition-all hover:opacity-75 dark:text-gray-100",href:n.url,rel:"noopener noreferrer",target:"_blank",title:`Visit ${new URL(n.url).hostname}`,children:new URL(n.url).hostname}),s.jsx("span",{className:"text-border",children:"|"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",title:"Active visitors in the last 5 minutes Â· Updates every 60 seconds",children:[s.jsxs("span",{className:"text-sm",children:[i?"":M(c)," online"]}),s.jsx("div",{className:`size-2 rounded-full ${i?"animate-pulse bg-muted":c?"bg-green-500":"border border-muted-foreground"}`})]})]})]})}),s.jsxs(I,{className:"sticky top-0 z-40 transform-gpu flex-col items-start gap-y-0 border-none bg-white/70 pb-6 pt-9 backdrop-blur-md lg:flex-row lg:items-center dark:bg-black",children:[s.jsx(P,{children:s.jsxs(R,{defaultValue:o,responsive:!0,children:[s.jsxs(f,{value:"/analytics/",onClick:()=>{t("/analytics/")},children:[s.jsx($,{}),"Overview"]}),l?.analytics.webAnalytics&&s.jsxs(f,{value:"/analytics/web/",onClick:()=>{t("/analytics/web/")},children:[s.jsx(p,{}),"Web traffic"]}),l?.newslettersEnabled&&s.jsxs(f,{value:"/analytics/newsletters/",onClick:()=>{t("/analytics/newsletters/")},children:[s.jsx(B,{}),"Newsletters"]}),s.jsxs(f,{value:"/analytics/growth/",onClick:()=>{t("/analytics/growth/")},children:[s.jsx(T,{}),"Growth"]})]})}),e]})]})},Z=({children:e,...t})=>s.jsx("div",{className:"size-full",children:s.jsx("div",{className:"relative size-full",...t,children:s.jsx("div",{className:"mx-auto flex size-full max-w-page flex-col",children:e})})}),de=({children:e})=>s.jsx(Z,{children:s.jsx("div",{className:"grid w-full grow",children:s.jsx("div",{className:"flex h-full flex-col px-8",children:e})})}),ee=()=>s.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-4 text-gray-700",children:[s.jsx("div",{className:"-mt-10 flex size-18 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-950",children:s.jsx(_,{size:24,strokeWidth:1.5})}),"No stats available for this filter."]}),te=({children:e,className:t,...r})=>s.jsx("section",{className:S("flex grow flex-col items-stretch gap-6 w-full pb-8",t),...r,children:e}),fe=({isLoading:e,data:t,children:r,loadingComponent:l=s.jsx(D,{}),emptyComponent:n=s.jsx(ee,{})})=>s.jsx(te,{children:e?l:t!==void 0&&t&&t.length===0?n:r});export{oe as D,de as S,he as a,fe as b,q as d,ue as g,me as s};
