import{aP as U,j as s,B as F,aU as T,e as _,y as I,by as V,bz as q,bA as J,bB as Q,bC as X,bD as Y,aj as b,r as g,u as Z,S as E,aR as A,bE as ss,bK as es}from"./index-exFCQBCk.js";import{E as G}from"./empty-indicator-SsCyCd50.js";import{A as rs,U as as,a as ts,W as ns,C as os}from"./wallet-cards-xpilOd6G.js";import{S as D}from"./source-icon-DjyV6RS6.js";import{p as cs,e as is}from"./source-utils-B1S3ZHA2.js";import{C as N,a as w,b as S,f as v,c as C,g as ls}from"./pagemenu-DlQF5jN4.js";import{a as ds,b as ms,c as L,d as f,e as hs,f as y}from"./table-P4FGxGxN.js";import{K as M,d as H,a as R,b as $,c as k}from"./kpi-card-DShFKtte.js";import{P as xs,a as ps}from"./post-analytics-header-BV_8onIF.js";import{u as us}from"./post-analytics-context-CxuzZluw.js";import{g as P}from"./currency-fEUUCkj0.js";import{c as js,d as bs,a as gs}from"./stats-C4LbW8IV.js";const fs=({className:o})=>{const t=U();return s.jsx(G,{actions:s.jsx(F,{variant:"outline",onClick:()=>t("/settings/analytics",{crossApp:!0}),children:"Open settings"}),className:o,description:"Enable member source tracking in settings to see which content drives member growth.",title:"Member sources have been disabled",children:s.jsx(rs,{})})},K="https://www.google.com/s2/favicons?domain=ghost.org&sz=64",W=({headerStyle:o="table",children:t="Source",data:h,mode:r,defaultSourceIconUrl:a=K})=>{const{appSettings:c}=T();if(r==="growth")return s.jsxs(ds,{children:[s.jsx(ms,{children:s.jsxs(L,{children:[s.jsx(f,{className:"min-w-[320px]",variant:o==="table"?"default":"cardhead",children:t}),s.jsx(f,{className:"w-[110px] text-right",children:"Free members"}),c?.paidMembersEnabled&&s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"w-[110px] text-right",children:"Paid members"}),s.jsx(f,{className:"w-[100px] text-right",children:"MRR impact"})]})]})}),s.jsx(hs,{children:h?.map(e=>{const l=d=>Math.round(d/100);return s.jsxs(L,{className:"last:border-none",children:[s.jsx(y,{children:e.linkUrl?s.jsxs("a",{className:"group flex items-center gap-2",href:e.linkUrl,rel:"noreferrer",target:"_blank",children:[s.jsx(D,{defaultSourceIconUrl:a,displayName:e.displayName,iconSrc:e.iconSrc}),s.jsx("span",{className:"group-hover:underline",children:e.displayName})]}):s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(D,{defaultSourceIconUrl:a,displayName:e.displayName,iconSrc:e.iconSrc}),s.jsx("span",{children:e.displayName})]})}),s.jsxs(y,{className:"text-right font-mono text-sm",children:["+",b(e.free_members||0)]}),c?.paidMembersEnabled&&s.jsxs(s.Fragment,{children:[s.jsxs(y,{className:"text-right font-mono text-sm",children:["+",b(e.paid_members||0)]}),s.jsxs(y,{className:"text-right font-mono text-sm",children:["+$",b(l(e.mrr||0))]})]})]},e.source)})})]})},ys=({title:o="Top sources",description:t,data:h,mode:r="visits",range:a=30,totalVisitors:c=0,siteUrl:e,siteIcon:l,defaultSourceIconUrl:d=K,getPeriodText:i,className:p})=>{const{appSettings:x}=T(),n=_.useMemo(()=>cs({data:h,mode:r,siteUrl:e,siteIcon:l,defaultSourceIconUrl:d}),[h,e,l,r,d]),m=_.useMemo(()=>is({processedData:n,totalVisitors:c,mode:r}),[n,c,r]),u=m.slice(0,10),j=t||(r==="growth"?"Where did your growth come from?":`How readers found your ${a?"site":"post"}${a&&i?` ${i(a)}`:""}`),B=r==="growth"?"Sources":"Top sources",z=r==="growth"?"Where did your growth come from?":`How readers found your ${a?"site":"post"}${a&&i?` ${i(a)}`:""}`;return s.jsxs(N,{className:I("group/datalist w-full max-w-[calc(100vw-64px)] overflow-x-auto sidebar:max-w-[calc(100vw-64px-280px)]",p),"data-testid":"top-sources-card",children:[u.length<=0&&s.jsxs(w,{children:[s.jsx(S,{children:o}),s.jsx(v,{children:j})]}),s.jsx(C,{children:r==="growth"&&!x?.analytics.membersTrackSources?s.jsx(fs,{className:"py-10"}):u.length>0?s.jsx(W,{data:u,defaultSourceIconUrl:d,getPeriodText:i,headerStyle:"card",mode:r,range:a,children:s.jsxs(w,{children:[s.jsx(S,{children:o}),s.jsx(v,{children:j})]})}):s.jsx("div",{className:"py-20 text-center text-sm text-gray-700",children:s.jsx(G,{className:"h-full",description:r==="growth"&&"Once someone signs up on this post, sources will show here",title:`No sources data available ${i?i(a):""}`,children:s.jsx(as,{strokeWidth:1.5})})})}),m.length>10&&s.jsx(ls,{children:s.jsxs(V,{children:[s.jsx(q,{asChild:!0,children:s.jsxs(F,{variant:"outline",children:["View all ",s.jsx(ts,{})]})}),s.jsxs(J,{className:"overflow-y-auto pt-0 sm:max-w-[600px]",children:[s.jsxs(Q,{className:"sticky top-0 z-40 -mx-6 bg-background/60 p-6 backdrop-blur",children:[s.jsx(X,{children:B}),s.jsx(Y,{children:z})]}),s.jsx("div",{className:"group/datalist",children:s.jsx(W,{data:m,defaultSourceIconUrl:d,getPeriodText:i,mode:r,range:a})})]})]})})]})},Ns=o=>{const{data:t,isLoading:h}=js(o),{data:r,isLoading:a}=bs(o),{data:c,isLoading:e}=gs(),l=g.useMemo(()=>t?.stats||[],[t]),d=g.useMemo(()=>r?.stats.length===0?{free_members:0,paid_members:0,mrr:0}:r?.stats[0],[r]),{selectedCurrency:i,currencySymbol:p}=g.useMemo(()=>{if(c?.stats&&c?.meta?.totals){const n=c.meta.totals;let m=n[0];if(!m)return{selectedCurrency:"usd",currencySymbol:P("usd")};for(const j of n)j.mrr>m.mrr&&(m=j);const u=m.currency;return{selectedCurrency:u,currencySymbol:P(u)}}return{selectedCurrency:"usd",currencySymbol:P("usd")}},[c]);return{isLoading:g.useMemo(()=>h||a||e,[h,a,e]),stats:l,totals:d,selectedCurrency:i,currencySymbol:p}},O=o=>Math.round(o/100),Cs=()=>{const{data:o}=us(),{postId:t}=Z(),{stats:h,totals:r,isLoading:a,currencySymbol:c}=Ns(t||""),{appSettings:e}=T(),l=U(),d=o?.url,i=o?.icon;let p="flex flex-col items-stretch gap-6",x="";return e?.paidMembersEnabled||(p="grid grid-cols-1 border rounded-md",x="border-none hover:shadow-none"),s.jsxs(s.Fragment,{children:[s.jsx(xs,{currentTab:"Growth"}),s.jsx(ps,{children:a?s.jsxs("div",{className:p,children:[s.jsx(N,{className:x,children:s.jsx(C,{className:"grid grid-cols-3 p-0",children:Array.from({length:3},(n,m)=>s.jsxs("div",{className:"h-[98px] gap-1 border-r px-6 py-5 last:border-r-0",children:[s.jsx(E,{className:"w-2/3"}),s.jsx(E,{className:"h-7 w-12"})]},m))})}),s.jsxs(N,{className:x,children:[s.jsxs(w,{children:[s.jsx(S,{children:"Top sources"}),s.jsx(v,{children:"Where did your growth come from?"})]}),s.jsxs(C,{children:[s.jsx(A,{}),s.jsx(ss,{className:"pt-6"})]})]})]}):s.jsxs("div",{className:p,children:[s.jsxs(N,{className:x,"data-testid":"members-card",children:[s.jsxs(w,{className:"hidden",children:[s.jsx(S,{children:"Newsletters"}),s.jsx(v,{children:"How did this post perform"})]}),s.jsx(C,{className:"p-0",children:s.jsxs("div",{className:`flex flex-col md:grid md:items-stretch ${e?.paidMembersEnabled?"md:grid-cols-3":"md:grid-cols-1"}`,children:[s.jsxs(M,{className:"grow",children:[s.jsx(H,{onClick:()=>{const n=encodeURIComponent(`signup:'${t}'+conversion:-'${t}'`);l(`/members?filterParam=${n}`,{crossApp:!0})},children:"View members →"}),s.jsxs(R,{onClick:()=>{const n=encodeURIComponent(`signup:'${t}'+conversion:-'${t}'`);l(`/members?filterParam=${n}`,{crossApp:!0})},children:[s.jsx(es,{strokeWidth:1.5}),"Free members"]}),s.jsx($,{children:s.jsx(k,{children:b(r?.free_members||0)})})]}),e?.paidMembersEnabled&&s.jsxs(s.Fragment,{children:[s.jsxs(M,{className:"grow",children:[s.jsx(H,{onClick:()=>{const n=encodeURIComponent(`conversion:'${t}'`);l(`/members?filterParam=${n}`,{crossApp:!0})},children:"View members →"}),s.jsxs(R,{onClick:()=>{const n=encodeURIComponent(`conversion:'${t}'`);l(`/members?filterParam=${n}`,{crossApp:!0})},children:[s.jsx(ns,{strokeWidth:1.5}),"Paid members"]}),s.jsx($,{children:s.jsx(k,{children:b(r?.paid_members||0)})})]}),s.jsxs(M,{className:"grow",children:[s.jsxs(R,{children:[s.jsx(os,{strokeWidth:1.5}),"MRR"]}),s.jsx($,{children:s.jsxs(k,{children:["+",c,O(r?.mrr||0)]})})]})]})]})})]}),!e?.paidMembersEnabled&&s.jsx(A,{}),s.jsx(ys,{className:x,data:h,mode:"growth",siteIcon:i,siteUrl:d})]})})]})},Ds=Object.freeze(Object.defineProperty({__proto__:null,centsToDollars:O,default:Cs},Symbol.toStringTag,{value:"Module"}));export{O as c,Ds as g,Ns as u};
